<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Community Forum — Exam Scam Reporter</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="common.css">
</head>
<body>
  <header>
    <div style="display:flex;align-items:center;gap:12px">
      <img src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='36' height='36'><rect width='36' height='36' rx='8' fill='%230b63ff'/><text x='18' y='24' font-size='14' text-anchor='middle' fill='white' font-family='Arial'>ES</text></svg>" alt="logo" style="width:36px;height:36px;border-radius:6px"/>
      <div style="font-weight:700">Exam Scam Reporter</div>
    </div>
    <nav class="nav">
      <a href="index.html">Home</a>
      <a href="report.html">Report Scam</a>
      <a href="forum.html">Community Forum</a>
      <a href="resources.html">Resources</a>
      <a href="center_verify.html">Verify Center</a>
    </nav>
  </header>

  <div class="container">
    <main class="card">
      <h2>Community Forum</h2>
      <p class="small">Categories: JEE | NEET | SSC | General Scam Advice</p>
      <div style="display:flex;gap:12px;margin-top:12px">
        <select id="category"><option>JEE</option><option>NEET</option><option>SSC</option><option>General</option></select>
        <input id="threadTitle" placeholder="Thread title..." style="flex:1">
        <button id="newThread">Create Thread</button>
      </div>

      <div id="threads" style="margin-top:12px"></div>
    </main>

    <aside class="card" style="margin-top:12px">
      <h3>Scam Alerts</h3>
      <div id="scamAlerts" class="small">No current alerts.</div>
    </aside>
  </div>

  <script>
    const api = '/api';
    async function loadThreads(){
      const r = await fetch(api + '/forum/threads');
      const t = await r.json();
      const container = document.getElementById('threads');
      if(t.length===0) container.innerHTML = '<div class="small">No threads yet.</div>';
      else container.innerHTML = t.map(th=>'<div style="padding:8px;border-bottom:1px solid #eef"><strong>'+th.title+'</strong><div class="small">'+th.category+' • '+th.createdAt+'</div><div class="small">'+(th.posts[0]?th.posts[0].text:'')+'</div><button onclick="openThread(\''+th.id+'\')">Open</button></div>').join('');
    }
    async function createThread(){
      const payload = { category: document.getElementById('category').value, title: document.getElementById('threadTitle').value, posts:[{text:'Thread created.'}] };
      await fetch(api + '/forum/threads', {method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});
      document.getElementById('threadTitle').value='';
      loadThreads();
    }
    function openThread(id){
      location.href = 'forum_thread.html?id=' + id;
    }
    document.getElementById('newThread').addEventListener('click', createThread);
    loadThreads();
  </script>
</body>
</html>
